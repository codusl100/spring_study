## 07 | 빈 생명주기 콜백

[1. 빈 생명주기 콜백](#빈-생명주기-콜백) <br>
[2. 인터페이스 InitializingBean, DisposableBean](#인터페이스-initializingbean-disposablebean) <br>
[3. 빈 등록 초기화, 소멸 메서드 지정](#빈-등록-초기화-소멸-메서드-지정) <br>
[4. 애노테이션 @PostConstruct, @PreDestroy](#애노테이션-postconstruct-predestroy) <br>
<br>

### 빈 생명주기 콜백
<hr>

- 데이터베이스 커넥션 풀이나 네트워크 소켓과 같은 것들은 애플리케이션 시작 시점에 필요한 연결을 미리 해두고, 애플리케이션 종료 시점에 연결을 모두 종료  
    - 이를 가능하게 하려면 **객체 초기화 작업**과 **종료 작업** 필요
- 스프링 빈의 라이프 사이클
    - *객체 생성 -> 의존 관계 주입*
    - 초기화 작업은 의존 관계 주입이 완료되고 일어남
        - 이 시점을 개발자는 **콜백 메서드**를 통해서 초기화 시점을 알게 됨
    - 스프링은 스프링 컨테이너가 종료되기 직전에 소멸 콜백을 줌
    > 1. 스프링 컨테이너 생성 
    > 2. 스프링 빈 생성(객체 생성) 
    > 3. 의존 관계 주입 
    > 4. **초기화 콜백**
    > 5. 사용 
    > 6. **소멸 전 콜백** 
    > 7. 스프링 종료

- 객체의 생성과 초기화 작업을 분리
    - 생성자는 필수 정보(파라미터)를 받고, 메모리를 할당하여 객체의 생성을 담당
    - 초기화는 이렇게 생성된 값들을 활용해서 외부 커넥션을 연결하는 등 무거운 작업 담당
    - *객체를 생성하는 부분과 초기화 하는 부분을 명확하게 나누는 것이 유지보수 관점에서 좋음*

<br>


### 인터페이스 InitializingBean, DisposableBean
<hr>

- 클래스에 `InitializingBean`, `DisposableBean` 인터페이스 상속
    - InitializingBean : afterPropertiesSet(초기화 콜백 메서드) 지원
        - 초기화 진행
    - DisposableBean : destory(소멸 직전 콜백 메서드) 지원
        - 소멸 로직 추가
- 인터페이스 방식의 단점
    - 스프링 전용이기에 스프링 인터페이스에 의존
    - 콜백 메서드들의 이름을 변경할 수 없고 코드를 고칠 수 없는 외부 라이브러리에는 적용할 수 없음

<br>

### 빈 등록 초기화, 소멸 메서드 지정
<hr>

- 설정 정보에 `initMethod`와 `destoryMethod`를 지정
- 특징
    - 인터페이스 방식의 단점 극복
    - 메서드 이름을 자유롭게 줄 수 있음    
        - ex) initMethod = "init", destoryMethod = "close
    - 스프링에 의존적이지 않으며 외부 라이브러리에도 적용 가능
    - 종료 메서드는 기본값이 'inferred'로 되어 있어 자동으로 추론해 찾아내기에 설정하지 않아도 상관 없음

<br>

### 애노테이션 @PostConstruct, @PreDestroy
<hr>

```
@PostConstruct
public void init() {
	connect();
	call("초기화 연결 메시지");
}
@PreDestroy
public void close() {
    disConnect();
}
```
- 특징
    - 두 어노테이션만 달아주면 되기에 굉장히 간단
    - 최신 스프링에서 가장 권장하는 방법이고 매우 편리함
    - 자바 표준이기에 스프링이 아닌 다른 컨테이너에서도 작동하지만, 외부 라이브러리에 이용 불가
- **두 어노테이션을 사용 권장**