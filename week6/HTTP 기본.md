## 11 | HTTP 기본

[1. 모든 것이 HTTP](#모든-것이-http) <br>
[2. 클라이언트 서버 구조](#클라이언트-서버-구조) <br>
[3. 무상태(Stateless) 프로토콜](#무상태stateless-프로토콜) <br>
[4. 비연결성(connectionless)](#비연결성connectionless) <br>
[5. HTTP 메세지](#http-메세지) <br>

<br>

### 모든 것이 HTTP
<hr>

> **HTTP** 
>
> HyperText Transfer Protocol의 약자로 지금은 모든 것을 HTTP 메시지에 담아서 전송

- HTML 문서나 텍스트뿐만 아니라 이미지, 음성, 영상 등의 파일과 API에 주로 쓰이는 JSON, XML까지 거의 모든 형태의 데이터 전송 가능
- 서버 간 데이터를 주고 받을 때도 대부분 HTTP 사용
    - TCP만 직접 이용하는 경우 거의 없음

<br>

#### **HTTP 역사**

- HTTP/0.9 1991년: GET 메서드만 지원, HTTP 헤더 X
- HTTP/1.0 1996년: 메서드, 헤더 추가
- **HTTP/1.1** 1997년: 가장 많이 사용, 우리에게 가장 중요한 버전
    - RFC2068 (1997) -> **RFC2616 (1999)** -> RFC7230~7235 (2014)
- HTTP/2 2015년: 성능 개선
- HTTP/3 진행 중: TCP 대신에 UDP 사용, 성능 개선

<br>

#### **기반 프로토콜**
- TCP: HTTP/1.1, HTTP/2
- UDP: HTTP/3
- 2022년 2월 기준 대부분 HTTP/2를 주로 사용, 유튜브의 경우 HTTP/3을 주로 사용

<br>

#### **HTTP 특징**
- 클라이언트-서버 구조
- 무상태 프로토콜(Stateless), 비연결성
- 단순하고 확장 가능

<br>

### 클라이언트 서버 구조
<hr>

- 클라이언트가 먼저 요청 보내면 그에 맞게 서버가 응답하는 구조
- 클라이언트와 서버를 분리함으로써 각각 독립적으로 진화할 수 있음
- HTTP는 클라이언트-서버 아키텍처를 따르는 프로토콜로 통신을 하는 상황에서 클라이언트와 서버로 역할이 나뉜 상태에서 메세지를 주고받는 방식을 취함

<br>

### 무상태(Stateless) 프로토콜
<hr>

> 서버가 클라이언트의 상태를 보존하지 않음
>
> 장점 : 서버의 확장성이 높아짐 (scale out)
>
> 단점 : 클라이언트가 추가 데이터를 전송해야 함

<br>

#### **상태 유지(Stateful)**
- *통신하는 클라이언트의 정보를 유지한 채로 통신*
- 어떤 가게에서 물건을 구매한다고 했을 때, 점원이 고객의 정보를 기억하고 있기 때문에 한 번 말했던 것은 계속 말할 필요가 없음
- 중간에 점원이 바뀌면 안 됨
    - 바뀐다면 고객에 대한 정보를 다른 점원에서 모두 알려줘야 함

<br>

#### **무상태(Stateless)**
- *통신하는 클라이언트의 정보를 유지하지 않고 통신*
- 어떤 가게에서 물건을 구매한다고 했을 때, 점원은 고객의 정보를 기억하지 않기 때문에 고객이 자신의 정보를 지속적으로 점원에게 말해줘야 함
- 중간에 점원이 바뀌어도 됨
- 응답 서버를 쉽게 바꿀 수 있기 때문에 스케일 아웃에 유리

<br>

#### **실무에서 무상태(Stateless)의 한계**
- 모든 것을 무상태로 설계하기엔 어려움
    - ex) 로그인이 필요 없는 단순 서비스는 무상태로 구현 가능
        - 로그인 같이 상태 유지 필요한 경우 상태 정보를 서버에 유지
        - 브라우저 쿠키와 서버의 세션 등을 결합해 상태 유지에 사용
- 상태 유지는 필요한 부분에만 최소한으로 사용하는 것이 좋음

<br>

### 비연결성(Connectionless)
<hr>

- 서버 한 대와 클라이언트 1, 2, 3이 있을 때
    - **연결을 유지하는 모델**
        - 이전에 클라이언트 1의 요청이 있었다면, 이후에 클라이언트 3과 통신할 때도 클라이언트 1과의 연결을 유지
    - **연결을 유지하지 않는 모델**
        - 클라이언트 1의 요청에 대한 응답이 끝나면 바로 연결을 끊기 때문에 다른 클라이언트와 통신할 때는 클라이언트 1과의 연결 상태를 유지하지 않음

<br>

#### **비연결성 특징**

- HTTP는 기본적으로 연결을 유지하지 않는 모델
- 일반적으로 초 단위 이하의 빠른 속도로 응답
- 1시간 동안 수천명이 서비스를 이용할지라도 사실상 실제 서버에서 동시에 처리하는 요청은 수십 개 이하로 매우 작음
- 서버 자원을 매우 효율적으로 사용 가능

<br>

#### **비연결성 한계와 극복**

- 매번 TCP/IP 연결(ex. 3 Way Handshake)을 새로 맺어야 하기 때문에 오버헤드 증가
- 웹 브라우저로 사이트를 요청할 때 HTML 뿐만 아니라 JS, CSS, 이미지 등 여러 리소스를 다운로드하는데 매번 새로 연결하면 매우 비효율적
- 현재는 HTTP 지속 연결(Persistent Connections)로 문제를 해결했으며 HTTP/2와 HTTP/3에서 더욱 최적화

<br>

#### **HTTP 지속 연결(Persistent Connections)**

- 클라이언트와 서버가 연결을 할 때 1초, 데이터를 주고받을 때 1초, 연결을 종료할 때 1초가 걸린다고 가정
- **지속 연결을 하지 않을 시**, 3개의 데이터를 주고받는다면 각각 연결과 종료를 하기 때문에 3초씩 *총 9초 소요*
- **지속 연결을 하면**, 주고받을 데이터가 있는 동안은 연결을 유지하기 때문에 연결 1초, 3개의 데이터 3초, 종료 1초 *총 5초 소요*

<br>

#### **Statless를 기억하자**
- 서버 개발자들이 주로 어려워하는 업무
- 정말 같은 시간에 딱 맞춰 발생하는 대용량 트래픽 (주로 이벤트)
    - 이런 경우 stateless로 최대한 구현할 수 있어야 대용량 트래픽에 효율적인 대응 가능

### HTTP 메세지
<hr>

![image](https://github.com/codusl100/spring_study/assets/77263479/04ccfe9f-16cd-4f42-aceb-d293ea3001d2)

```
HTTP-message  = start-line
                *( header-filed CRLF )
                CRLF
                [ message- body ]
```

<br>

#### **Start-line(시작 라인)**

**요청**
<br>

`GET /search?q=hello&hl=ko HTTP/1.1`
- request-line = method SP(공백) request-target SP HTTP-version CRLF(엔터)
- HTTP 메서드 : 서버가 수행해야 할 동작 - Get
- 요청 대상 : 일반적으로 "/"로 시작하는 절대 경로 - /search?q=hello&hl=ko
- HTTP Version - HTTP/1.1
<br>
<br>

**응답**
<br>

`HTTP/1.1 200 OK`
- status-line = HTTP-version SP status-code SP reason-phrase CRLF
- HTTP Version - HTTP/1.1
- 상태 코드: 요청 성공, 실패를 나타냄 - 200
- 이유 문구: 사람이 이해할 수 있는 짧은 상태 코드나 설명 - OK

<br>

#### **HTTP 헤더**

**요청 메세지**
<br>

`Host: www.google.com`

<br>

**응답 메세지**
<br>

`Content-Type: text/html;charset=UTF-8`
<br>

`Content-Length: 3423`
- header-field = field-name ":" OWS(띄어쓰기 허용) field-value OWS
- field-name은 대소문자 구분 없음
- HTTP 전송에 필요한 모든 메타 데이터

<br>

**HTTP 헤더 사용 목적**

- HTTP 전송에 필요한 모든 부가 정보를 담음
    - ex) message-body 내용, 크기, 압축 정보, 인증 등 
- 필요한 경우 임의의 헤더를 추가 가능

<br>

**HTTP 메세지 바디**
```
<html>
  <body>
    ...
  </body>
</html>
```
- 실제 전송할 데이터
- HTML, 텍스트, 이미지, 영상, JSON 등 바이트로 표현할 수 있는 모든 데이터 전송 가능